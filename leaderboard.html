<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EcoQuest Leaderboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <style>
    .rank-1 { background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); }
    .rank-2 { background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%); }
    .rank-3 { background: linear-gradient(135deg, #cd7f32 0%, #e8a87c 100%); }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans">

  <div class="flex min-h-screen">

    <!-- SIDEBAR -->
    <div class="w-20 md:w-64 bg-gray-800 border-r border-gray-700 flex-col hidden sm:flex">
      <div class="h-16 flex items-center justify-center md:justify-start md:px-6 border-b border-gray-700">
        <h1 class="text-2xl font-extrabold bg-gradient-to-r from-green-400 to-lime-500 bg-clip-text text-transparent hidden md:block">EcoQuest</h1>
        <i class="fa-solid fa-leaf text-green-400 text-2xl md:hidden"></i>
      </div>
      <nav class="flex-1 p-4 space-y-2">
        <a href="index.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-300 hover:bg-green-600/40 hover:text-white transition-all duration-200">
          <i class="fa-solid fa-house"></i>
          <span class="hidden md:block">Dashboard</span>
        </a>
        <a href="ecolessons.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-300 hover:bg-green-600/40 hover:text-white transition-all duration-200">
          <i class="fa-solid fa-seedling"></i>
          <span class="hidden md:block">Eco Lessons</span>
        </a>
        <a href="missions.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-300 hover:bg-green-600/40 hover:text-white transition-all duration-200">
          <i class="fa-solid fa-recycle"></i>
          <span class="hidden md:block">Green Missions</span>
        </a>
        <a href="leaderboard.html" class="flex items-center gap-3 px-4 py-3 rounded-lg bg-green-600 text-white font-medium shadow-lg shadow-green-500/20">
          <i class="fa-solid fa-trophy"></i>
          <span class="hidden md:block">Leaderboard</span>
        </a>
        <a href="saved.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-300 hover:bg-green-600/40 hover:text-white transition-all duration-200">
          <i class="fa-solid fa-bookmark"></i>
          <span class="hidden md:block">Saved Topics</span>
        </a>
      </nav>

      <div class="p-4 border-t border-gray-700">
        <a href="profilePage.html" class="flex items-center gap-3 px-4 py-3 rounded-xl text-gray-300 bg-gray-800/50 hover:bg-green-600/50 hover:text-white transition-all duration-300 ease-in-out shadow-md ring-1 ring-gray-700 hover:ring-green-400">
          <img src="https://via.placeholder.com/40" class="w-8 h-8 rounded-full border-2 border-green-500 hidden md:block" />
          <span class="hidden md:block font-semibold tracking-wide">Profile</span>
        </a>
      </div>
    </div>

    <main class="flex-1">

      <!-- HEADER -->
      <header class="h-16 flex items-center justify-between px-6 bg-gray-900 border-b border-gray-700">
        <h2 class="text-2xl font-semibold">Leaderboard</h2>
        <div class="flex items-center gap-4">
          <button class="text-gray-400 hover:text-white"><i class="fa-solid fa-search"></i></button>
          <button class="text-gray-400 hover:text-white"><i class="fa-solid fa-bell"></i></button>
          <img src="https://via.placeholder.com/40" class="w-8 h-8 rounded-full border-2 border-green-500" />
        </div>
      </header>

      <!-- CONTENT -->
      <div class="p-6 max-w-4xl mx-auto">

        <!-- Top 3 Podium -->
        <div class="mb-8">
          <div class="flex items-end justify-center gap-4 mb-8">
            
            <!-- 2nd Place -->
            <div class="flex flex-col items-center">
              <div class="w-20 h-20 rounded-full border-4 border-gray-400 overflow-hidden mb-2">
                <img id="top2-avatar" src="https://via.placeholder.com/80" class="w-full h-full object-cover" />
              </div>
              <div class="rank-2 w-8 h-8 rounded-full flex items-center justify-center text-gray-800 font-bold mb-2 shadow-lg">2</div>
              <h3 id="top2-name" class="font-bold text-lg">Player 2</h3>
              <p id="top2-score" class="text-gray-400 text-sm">0 XP</p>
              <div class="w-24 h-32 bg-gray-700 rounded-t-lg mt-2 flex items-center justify-center">
                <i class="fa-solid fa-medal text-4xl text-gray-400"></i>
              </div>
            </div>

            <!-- 1st Place -->
            <div class="flex flex-col items-center -mt-6">
              <div class="w-24 h-24 rounded-full border-4 border-yellow-400 overflow-hidden mb-2 shadow-lg shadow-yellow-500/50">
                <img id="top1-avatar" src="https://via.placeholder.com/96" class="w-full h-full object-cover" />
              </div>
              <div class="rank-1 w-10 h-10 rounded-full flex items-center justify-center text-gray-800 font-bold mb-2 shadow-lg">
                <i class="fa-solid fa-crown text-xl"></i>
              </div>
              <h3 id="top1-name" class="font-bold text-xl">Champion</h3>
              <p id="top1-score" class="text-green-400 text-sm font-semibold">0 XP</p>
              <div class="w-24 h-40 bg-gradient-to-b from-green-600 to-green-700 rounded-t-lg mt-2 flex items-center justify-center shadow-lg">
                <i class="fa-solid fa-trophy text-5xl text-yellow-400"></i>
              </div>
            </div>

            <!-- 3rd Place -->
            <div class="flex flex-col items-center">
              <div class="w-20 h-20 rounded-full border-4 border-amber-700 overflow-hidden mb-2">
                <img id="top3-avatar" src="https://via.placeholder.com/80" class="w-full h-full object-cover" />
              </div>
              <div class="rank-3 w-8 h-8 rounded-full flex items-center justify-center text-gray-800 font-bold mb-2 shadow-lg">3</div>
              <h3 id="top3-name" class="font-bold text-lg">Player 3</h3>
              <p id="top3-score" class="text-gray-400 text-sm">0 XP</p>
              <div class="w-24 h-24 bg-gray-700 rounded-t-lg mt-2 flex items-center justify-center">
                <i class="fa-solid fa-medal text-3xl text-amber-700"></i>
              </div>
            </div>

          </div>
        </div>

        <!-- Leaderboard List -->
        <div class="bg-gray-800 rounded-2xl border border-gray-700 overflow-hidden">
          <div class="bg-gray-700 px-6 py-4 flex items-center justify-between border-b border-gray-600">
            <h3 class="text-xl font-bold">All Rankings</h3>
            <span class="text-sm text-gray-400">Updated in real-time</span>
          </div>

          <div id="leaderboard-list" class="divide-y divide-gray-700">
            <!-- Players will be inserted here -->
          </div>
        </div>

      </div>
    </main>
  </div>

  <!-- Mobile nav -->
  <nav class="sm:hidden fixed bottom-0 left-0 w-full bg-gray-800 border-t border-gray-700 flex justify-around py-2">
    <a href="index.html" class="flex flex-col items-center p-2 text-gray-400 hover:text-white"><i class="fa-solid fa-house"></i><span class="text-xs mt-1">Home</span></a>
    <a href="ecolessons.html" class="flex flex-col items-center p-2 text-gray-400 hover:text-white"><i class="fa-solid fa-seedling"></i><span class="text-xs mt-1">Lessons</span></a>
    <a href="missions.html" class="flex flex-col items-center p-2 text-gray-400 hover:text-white"><i class="fa-solid fa-recycle"></i><span class="text-xs mt-1">Missions</span></a>
    <a class="flex flex-col items-center p-2 text-green-400"><i class="fa-solid fa-trophy"></i><span class="text-xs mt-1">Leaderboard</span></a>
  </nav>

  <script>
    // Leaderboard data stored in localStorage
    const LEADERBOARD_KEY = 'ecoquest_leaderboard';

    // Initialize with sample data if empty
    function getLeaderboard() {
      const stored = localStorage.getItem(LEADERBOARD_KEY);
      if (stored) {
        return JSON.parse(stored);
      }
      
      // Default players
      const defaultPlayers = [
        { name: 'Eco Warrior', score: 180, avatar: 'https://via.placeholder.com/100' },
        { name: 'Green Guardian', score: 850, avatar: 'https://via.placeholder.com/100' },
        { name: 'Nature Ninja', score: 720, avatar: 'https://via.placeholder.com/100' },
        { name: 'Planet Protector', score: 650, avatar: 'https://via.placeholder.com/100' },
        { name: 'Climate Champion', score: 590, avatar: 'https://via.placeholder.com/100' },
        { name: 'Earth Angel', score: 520, avatar: 'https://via.placeholder.com/100' },
        { name: 'Recycle Ranger', score: 480, avatar: 'https://via.placeholder.com/100' },
        { name: 'Solar Sage', score: 430, avatar: 'https://via.placeholder.com/100' },
        { name: 'Wind Walker', score: 390, avatar: 'https://via.placeholder.com/100' },
        { name: 'Ocean Keeper', score: 350, avatar: 'https://via.placeholder.com/100' }
      ];
      
      saveLeaderboard(defaultPlayers);
      return defaultPlayers;
    }

    function saveLeaderboard(players) {
      localStorage.setItem(LEADERBOARD_KEY, JSON.stringify(players));
    }

    function sortLeaderboard(players) {
      return players.sort((a, b) => b.score - a.score);
    }

    function renderLeaderboard() {
      let players = getLeaderboard();
      players = sortLeaderboard(players);

      // Update top 3 podium
      if (players[0]) {
        document.getElementById('top1-name').textContent = players[0].name;
        document.getElementById('top1-score').textContent = `${players[0].score} XP`;
        document.getElementById('top1-avatar').src = players[0].avatar;
      }
      if (players[1]) {
        document.getElementById('top2-name').textContent = players[1].name;
        document.getElementById('top2-score').textContent = `${players[1].score} XP`;
        document.getElementById('top2-avatar').src = players[1].avatar;
      }
      if (players[2]) {
        document.getElementById('top3-name').textContent = players[2].name;
        document.getElementById('top3-score').textContent = `${players[2].score} XP`;
        document.getElementById('top3-avatar').src = players[2].avatar;
      }

      // Render full list
      const list = document.getElementById('leaderboard-list');
      list.innerHTML = '';

      players.forEach((player, index) => {
        const rank = index + 1;
        const row = document.createElement('div');
        row.className = 'px-6 py-4 flex items-center gap-4 hover:bg-gray-700/50 transition-colors';
        
        let rankBadge = '';
        if (rank === 1) {
          rankBadge = `<div class="w-10 h-10 rank-1 rounded-full flex items-center justify-center text-gray-800 font-bold text-lg shadow-lg"><i class="fa-solid fa-crown"></i></div>`;
        } else if (rank === 2) {
          rankBadge = `<div class="w-10 h-10 rank-2 rounded-full flex items-center justify-center text-gray-800 font-bold text-lg shadow-lg">2</div>`;
        } else if (rank === 3) {
          rankBadge = `<div class="w-10 h-10 rank-3 rounded-full flex items-center justify-center text-gray-800 font-bold text-lg shadow-lg">3</div>`;
        } else {
          rankBadge = `<div class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center text-gray-300 font-bold text-lg">${rank}</div>`;
        }

        row.innerHTML = `
          ${rankBadge}
          <img src="${player.avatar}" class="w-12 h-12 rounded-full border-2 border-green-500" />
          <div class="flex-1">
            <h4 class="font-semibold text-lg">${player.name}</h4>
            <p class="text-gray-400 text-sm">Level ${Math.floor(player.score / 100) + 1}</p>
          </div>
          <div class="text-right">
            <p class="text-2xl font-bold text-green-400">${player.score}</p>
            <p class="text-gray-400 text-sm">XP</p>
          </div>
        `;

        list.appendChild(row);
      });
    }

    // Expose function to add/update player score
    window.updatePlayerScore = function(name, newScore, avatar = 'https://via.placeholder.com/100') {
      let players = getLeaderboard();
      const existing = players.find(p => p.name === name);
      
      if (existing) {
        existing.score = newScore;
      } else {
        players.push({ name, score: newScore, avatar });
      }
      
      saveLeaderboard(players);
      renderLeaderboard();
    };

    // Listen for changes from other tabs
    window.addEventListener('storage', (e) => {
      if (e.key === LEADERBOARD_KEY) {
        renderLeaderboard();
      }
    });

    // Initial render
    renderLeaderboard();

    // Example: Update current user's score from dashboard state
    const STATE_KEY = 'ecoquest_state_v1';
    const PROFILE_KEY = 'ecoquest_profile_v1';
    
    try {
      const state = JSON.parse(localStorage.getItem(STATE_KEY));
      const profile = JSON.parse(localStorage.getItem(PROFILE_KEY));
      if (state && profile) {
        updatePlayerScore(profile.name, state.xp, profile.avatar);
      }
    } catch (e) {
      // No state yet
    }
  </script>

</body>
</html>